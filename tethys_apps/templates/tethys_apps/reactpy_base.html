{% load static tethys reactpy %}
<!DOCTYPE html>
<!--[if IE 7]> <html lang="en" class="ie ie7 h-100"> <![endif]-->
<!--[if IE 8]> <html lang="en"  class="ie ie8 h-100"> <![endif]-->
<!--[if IE 9]> <html lang="en"  class="ie9 h-100"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="h-100"> <!--<![endif]-->
  <head>
    {% if has_analytical %}
    {% include "analytical_head_top.html" %}
    {% endif %}
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Django" />

    <title>{{ title }} | {{ tethys_app.name }}</title>
    <link rel="shortcut icon" href="{% if site_globals.favicon and 'http' in site_globals.favicon %}{{ site_globals.favicon }}{% elif site_globals.favicon %}{% static site_globals.favicon %}{% else %}{% static 'tethys_portal/images/default_favicon.png' %}{% endif %}" />
    {% if tethys_app.enable_feedback %}
      <link href="{% static 'tethys_apps/css/feedback.css' %}" rel="stylesheet" />
    {% endif %}
    <link href="{% static 'tethys_portal/css/termsandconditions.min.css' %}"  rel="stylesheet" />
    {% for css in custom_css %}
      <link href="{{ css }}" rel="stylesheet" />
    {% endfor %}
    <style>
      :root {
        --app-primary-color: {{ tethys_app.color }};
        --app-secondary-color: {{ tethys_app.color|lighten:20 }};
      }

      #app-header .tethys-app-header {
        background: var(--app-primary-color, '#7ec1f7');
      }

      #app-header .tethys-app-header .icon-wrapper img {
        background: var(--app-primary-color, '#7ec1f7');
      }

      #app-header .btn-user-profile {
        background-color: rgba(255, 255, 255, 0.08);
        border: none;
        color: {{ site_globals.primary_text_color }};
      }
  
      #app-header .btn-user-profile:hover {
        background-color: rgba(255, 255, 255, 0.30);
      }

      #app-navigation .nav li a {
        color: var(--app-primary-color, '#7ec1f7');
      }

      #app-navigation .nav li.active a {
        color: var(--app-primary-color, '#7ec1f7');
      }

      #app-navigation .nav li a.active {
        background: var(--app-primary-color, '#7ec1f7');
        color: white;
      }

      #app-content-wrapper #app-content #app-actions {
        background: var(--app-secondary-color);
      }
      .styled-header-button:hover, .styled-header-button:focus {
        background-color: rgba(0, 0, 0, 0.1)!important;
        color: white;
        border: none;
        box-shadow: none;
      }
    </style>
    <script type="module">
      import React from "https://esm.sh/react@{{ reactjs_version }}"
      import ReactDOM from "https://esm.sh/react-dom@{{ reactjs_version }}"
      globalThis['React'] = React
      globalThis['ReactDOM'] = ReactDOM
    </script>

    {% if has_session_security %}
      {% include 'session_security/all.html' %}
      <link href="{% static 'tethys_portal/css/session_security_override.min.css' %}"  rel="stylesheet" />
    {% endif %}

    {% if has_analytical %}
      {% include "analytical_head_bottom.html" %}
    {% endif %}
  </head>

  <body class="h-100">
    {% if has_analytical %}
      {% include "analytical_body_top.html" %}
    {% endif %}

    {% component "tethys_apps.base.page_handler.page_component_wrapper" app=app user=request.user layout=layout_func component=component_func %}

    {% if has_terms %}
      {% include "terms.html" %}
    {% endif %}

    <div id="page-attributes" data-username="{{ user.username }}" style="display: none;"></div>

    {% csrf_token %}

    {{ tethys.doc_cookies.script_tag|safe }}
    
    {% if tethys_app.enable_feedback %}
      <script src="{% static 'tethys_apps/js/feedback.js' %}" type="text/javascript"></script>
    {% endif %}

    {% for js in custom_js %}
      <script src="{{ js }}" type="text/javascript"></script>
    {% endfor %}

    {% if has_analytical %}
      {% include "analytical_body_bottom.html" %}
    {% endif %}
  </body>
</html>